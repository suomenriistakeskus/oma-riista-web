<div class="row">
    <div class="col-xs-3">
        <h3 ng-bind="::$ctrl.gameSpeciesName"></h3>
    </div>
    <div class="col-xs-3">
        <table class="table">
            <tr>
                <th class="text-center" translate="club.permit.permitAmountTotal"></th>
                <th class="text-center" translate="club.permit.permitUnallocated"></th>
            </tr>
            <tr>
                <td class="text-center">
                    <strong ng-bind="::$ctrl.permitTotal | number"></strong>
                </td>
                <td class="text-center">
                    <strong ng-bind="$ctrl.permitUnallocated | number"></strong>
                </td>
            </tr>
        </table>
    </div>
    <div class="col-xs-2 col-xs-offset-2">
        <button type="button" class="btn btn-default btn-block"
                ng-click="$ctrl.cancel()"
                translate="global.button.cancel">
        </button>
    </div>
    <div class="col-xs-2">
        <button type="button" class="btn btn-primary btn-block"
                ng-click="$ctrl.saveAllocations()"
                ng-disabled="allocationForm.$invalid"
                translate="global.button.save"></button>
    </div>
</div>

<form name="allocationForm" novalidate role="form"
      ng-model-options="{allowInvalid: true}">
    <table class="table table-condensed moose-permit-infotable-allocation">
        <thead>
        <tr class="topheader">
            <th colspan="1"></th>
            <th colspan="1">
                <r-with-tooltip content-key="club.permit.allocation.sumOfAllocated.top"
                                tooltip-key="club.permit.allocation.sumOfAllocated.topTooltip"></r-with-tooltip>
            </th>
            <th colspan="3">
                <r-with-tooltip content-key="club.permit.allocation.huntingPlan.top"
                                tooltip-key="club.permit.allocation.huntingPlan.topTooltip"></r-with-tooltip>
            </th>
            <th colspan="1">
                <r-with-tooltip content-key="club.permit.allocation.usedPermits.top"
                                tooltip-key="club.permit.allocation.usedPermits.topTooltip"></r-with-tooltip>
            </th>
            <th colspan="6">
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.top"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.topTooltip"></r-with-tooltip>
            </th>
            <th colspan="2">
                <r-with-tooltip content-key="club.permit.allocation.notEdible.top"
                                tooltip-key="club.permit.allocation.notEdible.topTooltip"></r-with-tooltip>
            </th>
        </tr>

        <tr class="lowheader">
            <th translate="club.permit.allocation.partner"></th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.sumOfAllocated.low"
                                tooltip-key="club.permit.allocation.sumOfAllocated.lowTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.huntingPlan.au"
                                tooltip-key="club.permit.allocation.huntingPlan.auTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.huntingPlan.an"
                                tooltip-key="club.permit.allocation.huntingPlan.anTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.huntingPlan.v"
                                tooltip-key="club.permit.allocation.huntingPlan.vTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.usedPermits.low"
                                tooltip-key="club.permit.allocation.usedPermits.lowTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.a"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.aTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.au"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.auTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.an"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.anTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.v"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.vu"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vuTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.harvestedSpecimens.vn"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vnTooltip"></r-with-tooltip>
            </th>

            <th>
                <r-with-tooltip content-key="club.permit.allocation.notEdible.a"
                                tooltip-key="club.permit.allocation.notEdible.aTooltip"></r-with-tooltip>
            </th>
            <th>
                <r-with-tooltip content-key="club.permit.allocation.notEdible.v"
                                tooltip-key="club.permit.allocation.notEdible.vTooltip"></r-with-tooltip>
            </th>
        </tr>
        </thead>

        <tbody>
        <tr class="summary">
            <td translate="club.permit.sumTitle"></td>

            <td>
                <r-with-tooltip bind-content="{{$ctrl.permitAllocated | number}}"
                                tooltip-key="club.permit.allocation.sumOfAllocated.cellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip bind-content="{{$ctrl.counter.allocatedBy('adultMales')}}"
                                tooltip-key="club.permit.allocation.huntingPlan.auCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip bind-content="{{$ctrl.counter.allocatedBy('adultFemales')}}"
                                tooltip-key="club.permit.allocation.huntingPlan.anCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip bind-content="{{$ctrl.counter.allocatedBy('young')}}"
                                tooltip-key="club.permit.allocation.huntingPlan.vCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.counter.harvestsBy('adult') + 0.5 * $ctrl.counter.harvestsBy('young') | number}}"
                        tooltip-key="club.permit.allocation.usedPermits.cellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('adult')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.aCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('adultMales')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.auCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('adultFemales')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.anCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('young')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('youngMales')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vuCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('youngFemales')}}"
                                tooltip-key="club.permit.allocation.harvestedSpecimens.vnCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('adultsNotEdible')}}"
                                tooltip-key="club.permit.allocation.notEdible.aCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.counter.harvestsBy('youngsNotEdible')}}"
                                tooltip-key="club.permit.allocation.notEdible.vCellTooltip"></r-with-tooltip>
            </td>
        </tr>

        <tr ng-repeat="a in $ctrl.allocations">
            <td name-translated="a.huntingClubName"></td>
            <td>
                <r-with-tooltip bind-content="{{a.total | number}}"
                                tooltip-key="club.permit.allocation.sumOfAllocated.cellTooltip"></r-with-tooltip>
            </td>
            <td class="text-center">
                <div class="form-group" show-errors="{ trigger: 'keypress' }">
                    <input type="number" name="adultMales{{$index}}" class="form-control input-sm"
                           ng-min="0"
                           ng-max="$ctrl.floor($ctrl.permitUnallocated + a.adultMales)"
                           ng-model="a.adultMales"
                           ng-change="$ctrl.recalculate()">
                </div>
            </td>
            <td>
                <div class="form-group" show-errors="{ trigger: 'keypress' }">
                    <input type="number" name="adultFemales{{$index}}" class="form-control input-sm"
                           maxlength="3"
                           ng-min="0"
                           ng-max="$ctrl.floor($ctrl.permitUnallocated + a.adultFemales)"
                           ng-model="a.adultFemales"
                           ng-change="$ctrl.recalculate()">
                </div>
            </td>
            <td>
                <div class="form-group" show-errors="{ trigger: 'keypress' }">
                    <input type="number" class="form-control input-sm" name="young{{$index}}"
                           maxlength="3"
                           ng-min="0"
                           ng-max="$ctrl.floor($ctrl.permitUnallocated * 2 + a.young)"
                           ng-model="a.young"
                           ng-change="$ctrl.recalculate()">
                </div>
            </td>
            <td>
                <r-with-tooltip content-val="{{$ctrl.countUsedPermitForPartner(a.huntingClubId) | number}}"
                                tooltip-key="club.permit.allocation.usedPermits.cellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].adultMales+ $ctrl.harvestCounts[a.huntingClubId].adultFemales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.aCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].adultMales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.auCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].adultFemales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.anCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].youngMales + $ctrl.harvestCounts[a.huntingClubId].youngFemales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.vCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].youngMales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.vuCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].youngFemales}}"
                        tooltip-key="club.permit.allocation.harvestedSpecimens.vnCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].adultsNotEdible}}"
                        tooltip-key="club.permit.allocation.notEdible.aCellTooltip"></r-with-tooltip>
            </td>
            <td>
                <r-with-tooltip
                        content-val="{{$ctrl.harvestCounts[a.huntingClubId].youngsNotEdible}}"
                        tooltip-key="club.permit.allocation.notEdible.vCellTooltip"></r-with-tooltip>
            </td>
        </tr>
        </tbody>
    </table>
</form>
